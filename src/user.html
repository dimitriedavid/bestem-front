<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge" /><![endif]-->
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1"><!-- Place favicon.ico in the root directory -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" href="favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,300,400,700,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Caveat" rel="stylesheet">
    <title>Dashcore - Premium Software & Startup HTML</title><!-- themeforest:css -->
    <link rel="stylesheet" href="css/all.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/cookieconsent.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/odometer-theme-minimal.css">
    <link rel="stylesheet" href="css/prism-okaidia.css">
    <link rel="stylesheet" href="css/simplebar.css">
    <link rel="stylesheet" href="css/smart_wizard.css">
    <link rel="stylesheet" href="css/smart_wizard_theme_arrows.css">
    <link rel="stylesheet" href="css/smart_wizard_theme_circles.css">
    <link rel="stylesheet" href="css/smart_wizard_theme_dots.css">
    <link rel="stylesheet" href="css/swiper.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/rtl.css"><!-- endinject -->

    <style>
        .my_map {
            height: 400px;
            width: 100%;
            max-width: 800px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->
   
    <div id="navbar"></div>
    <script src="js/jquery.js"></script>
    <script>$("#navbar").load("partials/nav.html")</script>

    <main>
        <header class="page header text-contrast overlay gradient gradient-purple-blue alpha-8 image-background cover" style="background-image: url('img/bg/waves.jpg'); padding-top: 90px;">
            <div class="container py-4">
                <div class="row">
                    <div class="col-md-6">
                        <h1 class="display-4 text-contrast mb-4" id="username">Username</h1>
                        <p class="lead text-contrast">Email: <a id="email" style="color: #ffffff">example@example.com</a></p>
                    </div>
                    <div class="col-md-6">
                        <div class="row justify-content-end">
                            <button type="button" class="btn btn-danger" id="logout">Logout</button>
                        </div>
                        <div id="admin_panel" hidden>
                            <div class="row justify-content-end">
                                <p class="lead text-contrast">Admin panel</p>
                            </div>
                            <div class="row justify-content-end mb-4">
                                <a href="add_place.html" type="button" class="btn btn-success"><i class="fas fa-plus-circle"></i>  Add place</a>
                            </div>
                            <div class="row justify-content-end mb-4">
                                <button type="button" class="btn btn-warning"><i class="fas fa-cog"></i>  Edit places</button>
                            </div>
                        </div>
                        <div id="not_admin_panel">
                            <div class="row justify-content-end">
                                <p class="lead text-contrast">Place editor</p>
                            </div>
                            <div class="row justify-content-end mb-4">
                                <a href="suggest_place.html" type="button" class="btn btn-success"><i class="fas fa-plus-circle"></i>  Suggest place</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="section">
            <div class="container py-4">
                <div class="row">
                    <div class="col-lg-6">
                        <h3><i class="fas fa-star"></i> <span id="score">100</span></h3>
                        <h4 id="description"><i class="fas fa-trophy"></i> Achievements</h4>
                        <div id="achievements">
                        </div>
                        <h4 id="description">Visited places</h4>
                        <div id="visited-places">
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <div id="footer"></div>
        <script src="js/jquery.js"></script>
        <script>$("#footer").load("partials/footer.html")</script>
        
    </main><!-- themeforest:js -->
    <script src="js/01.cookie-consent-util.js"></script>
    <script src="js/02.1.cookie-consent-themes.js"></script>
    <script src="js/02.2.cookie-consent-custom-css.js"></script>
    <script src="js/02.3.cookie-consent-informational.js"></script>
    <script src="js/02.4.cookie-consent-opt-out.js"></script>
    <script src="js/02.5.cookie-consent-opt-in.js"></script>
    <script src="js/02.6.cookie-consent-location.js"></script>
    <script src="js/card.js"></script>
    <script src="js/counterup2.js"></script>
    <script src="js/index.js"></script>
    <script src="js/noframework.waypoints.js"></script>
    <script src="js/odometer.min.js"></script>
    <script src="js/prism.js"></script>
    <script src="js/simplebar.js"></script>
    <script src="js/swiper.js"></script>
    <script src="js/popper.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/jquery.validate.js"></script>
    <script src="js/jquery.smartWizard.js"></script>
    <script src="js/plugins/jquery.animatebar.js"></script>
    <script src="js/feather.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/typed.js"></script>
    <script src="js/jquery.magnific-popup.js"></script>
    <script src="js/cookieconsent.min.js"></script>
    <script src="js/common-script.js"></script>
    <script src="js/forms.js"></script>
    <script src="js/stripe-bubbles.js"></script>
    <script src="js/stripe-menu.js"></script>
    <script src="js/cc.js"></script>
    <script src="js/pricing.js"></script>
    <script src="js/shop.js"></script>
    <script src="js/svg.js"></script>
    <script src="js/site.js"></script>
    <script src="js/03.demo.js"></script>
    <script src="js/js.cookie.min.js"></script>

    <script>
        function updateData(userData) {
            console.log(userData);
            $("#username").text(userData.name);
            $("#email").text(userData.email);
            $("#email").attr("href", "mailto:" + userData.email);
            $("#score").text(userData.score);
            if(userData.role == "Admin") {
                $("#admin_panel").removeAttr("hidden");
                $("#not_admin_panel").attr("hidden", true);
            }
            userData.visited_places.forEach(place => {
                $("#visited-places").append('<a href="check_in.html?id=' + place + '">' + place + '</a><br />');
            })
            userData.achievements.forEach(place => {
                $("#achievements").append('<h6 class="text-warning">' + place + '</h6><br />');
            })
        }

        var token = Cookies.get('auth-token');
        if(!token) {
            window.location = "login.html";
        }

        $(document).ready(function() {

            var userData;
            $.ajax({
                url: "http://206.189.54.1/user",
                type: 'get',
                headers: {'auth-token': token},
                success: function(data, textStatus, jqXHR) {
                    updateData(data);
                },
                error: function(jqXHR) {
                    console.log(jqXHR);
                    if (jqXHR.responseJSON) {
                        jqXHR.responseJSON.details.forEach(detail => {
                            alert(detail.message);
                        })
                    } else {
                        alert(jqXHR.responseText);
                    }
                }
            })

            $("#logout").on('click', function(e) {
                Cookies.remove('auth-token');
                window.location = 'index.html';
            });
        });
    </script>
</body>

</html>